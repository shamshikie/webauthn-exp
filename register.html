<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>登録</title>

  </head>
  <body>
    <h1>パスキー登録</h1>
    <div class="error" id="error" style="display: none"></div>
    <div class="message" id="message" style="display: none"></div>
    <form class="form-container" id="create-account">
      <div>
        <label for="username">ユーザーネーム:</label>
        <input name="username" id="username" value="username" required />
      </div>
      <div class="button-box">
        <button type="submit">登録</button>
      </div>
    </form>
    <a href="index.html">ログイン画面に戻る</a>
    <script>
        document.getElementById("create-account").addEventListener("submit", (event) => {
        event.preventDefault();
        let username = document.getElementById("username").value;
        navigator.credentials
            .create({
                publicKey: {
                    // if you're reading this code for inspiration, don't do this!!!
                    // this challenge should be random per request and verified on the server.
                    // i'm just lazy and don't want to code a server.
                    challenge: Uint8Array.from([1, 2, 3, 4]),
                    rp: {
                    name: "Conditional UI Example",
                    },
                    user: {
                        id: Uint8Array.from(
                            username.split("").map((c) => c.codePointAt(0))
                        ),
                        name: username,
                        displayName: "お前",
                    },
                    pubKeyCredParams: [],
                    authenticatorSelection: {
                        userVerification: "required",
                        residentKey: "required",
                        //authenticatorAttachment: "platform",
                    },
                },
            }).then((credential) => {
                console.log("Credential successfully created! Try logging in.");
                document.getElementById("create-account").style.display = "none";
            }).catch((error) => {
                console.error(error);
            });
        });
    </script>
  </body>
</html>
